<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xaman Wallet Connection</title>
    <script src="https://unpkg.com/xumm-sdk/dist/browser.min.js"></script>
</head>
<body>
    <h1>Xaman Wallet Connection</h1>
    <button id="connectButton">Xamanウォレットに接続</button>
    <p id="statusMessage"></p>

    <script>
        const connectButton = document.getElementById('connectButton');
        const statusMessage = document.getElementById('statusMessage');

        // Xamanアプリの API キーを設定
        const apiKey = '76f3b336-b7d0-4210-a8e5-aa2bacbd8ce2';

        // XummSdk インスタンスを作成
        const xumm = new XummSdk(76f3b336-b7d0-4210-a8e5-aa2bacbd8ce2);

        connectButton.addEventListener('click', async () => {
            try {
                statusMessage.textContent = '接続中...';

                // ペイロードを作成
                const payload = {
                    txjson: {
                        TransactionType: 'SignIn'
                    }
                };

                // ペイロードを送信
                const payloadResponse = await xumm.payload.create(payload);

                // QRコードのURLを取得
                const qrCodeUrl = payloadResponse.next.always;

                // ここでQRコードを表示するか、ユーザーにURLを提供します
                statusMessage.innerHTML = `QRコードをスキャンしてください：<br><img src="${qrCodeUrl}" alt="QR Code">`;

                // ペイロードの結果を待つ
                const payloadResult = await xumm.payload.get(payloadResponse.uuid);

                if (payloadResult.meta.signed) {
                    const userToken = payloadResult.application.issued_user_token;
                    statusMessage.textContent = `接続成功！ユーザートークン: ${userToken}`;
                } else {
                    statusMessage.textContent = '接続がキャンセルされました。';
                }
            } catch (error) {
                console.error('エラー:', error);
                statusMessage.textContent = '接続エラーが発生しました。';
            }
        });
    </script>
</body>
</html>